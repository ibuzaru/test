<form method="post">
    {% csrf_token %}
    {% if check_in_date and check_out_date %}
        <div>
            <p>チェックイン日: {{ check_in_date }}</p>
            <p>チェックアウト日: {{ check_out_date }}</p>
        </div>
    {% endif %}
    <p>
        {{ form.name.label_tag }}<br>
        {{ form.name }}
    </p>
    <p>
        {{ form.furigana.label_tag }}<br>
        {{ form.furigana }}
    </p>
    <p>
        {{ form.people.label_tag }}<br>
        {{ form.people }}
    </p>
    <p>
        {{ form.email.label_tag }}<br>
        {{ form.email }}
    </p>
    <p>
        {{ form.phone_number.label_tag }}<br>
        {{ form.phone_number }}
    </p>
    <p>
        {{ form.postal_code.label_tag }}<br>
        {{ form.postal_code }}<br>
        <button type="button" id="search-address">住所検索</button>
    </p>
    <p>
        {{ form.address.label_tag }}<br>
        {{ form.address }}
    </p>

    <form method="post">
        {% csrf_token %}
        <button type="submit">予約確認へ</button>
    </form>
    

    
   
</form>

<script>
    document.getElementById('search-address').addEventListener('click', function () {
        const postalCode = document.querySelector('input[name="postal_code"]').value;
        if (!/^\d{3}-\d{4}$/.test(postalCode)) {
            alert("郵便番号はXXX-XXXX形式で入力してください");
            return;
        }

        // 郵便番号APIの呼び出し
        fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${postalCode}`)
            .then(response => response.json())
            .then(data => {
                if (data.results) {
                    const address = data.results[0].address1 + data.results[0].address2 + data.results[0].address3;
                    document.querySelector('textarea[name="address"]').value = address;
                } else {
                    alert("住所が見つかりませんでした");
                }
            })
            .catch(error => {
                console.error("Error fetching address:", error);
                alert("住所検索でエラーが発生しました");
            });
    });

    const displayCheckin = document.getElementById('display-checkin');
    const displayCheckout = document.getElementById('display-checkout');
    const checkinDateInput = document.getElementById('checkin-date');
    const checkoutDateInput = document.getElementById('checkout-date');
    let checkinDate = null;
    let checkoutDate = null;

    function handleDateSelection(currentDate, dayElement) {
        if (!checkinDate || (checkinDate && checkoutDate)) {
            checkinDate = currentDate;
            checkoutDate = null;
            checkinDateInput.value = checkinDate.toISOString().slice(0, 10);
            checkoutDateInput.value = '';
            displayCheckin.textContent = checkinDate.toISOString().slice(0, 10);
            displayCheckout.textContent = '未選択';

            document.querySelectorAll('.day').forEach(el => el.classList.remove('selected', 'selected-out'));
            dayElement.classList.add('selected');
        } else if (!checkoutDate && currentDate > checkinDate) {
            checkoutDate = currentDate;
            checkoutDateInput.value = checkoutDate.toISOString().slice(0, 10);
            displayCheckout.textContent = checkoutDate.toISOString().slice(0, 10);
            dayElement.classList.add('selected-out');
        }
    }


</script>



