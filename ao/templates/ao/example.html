<form method="post" action="{% url 'example' %}">
    {% csrf_token %}
    <p>
        {{ form.check_in_date.label_tag }}<br>
        {{ form.check_in_date }}
    </p>
    <p>
        {{ form.check_out_date.label_tag }}<br>
        {{ form.check_out_date }}
    </p>
    <p>
        {{ form.name.label_tag }}<br>
        {{ form.name }}
    </p>
    <p>
        {{ form.furigana.label_tag }}<br>
        {{ form.furigana }}
    </p>
    <p>
        {{ form.people.label_tag }}<br>
        {{ form.people }}
    </p>
    <p>
        {{ form.email.label_tag }}<br>
        {{ form.email }}
    </p>
    <p>
        {{ form.phone_number.label_tag }}<br>
        {{ form.phone_number }}
    </p>
    <p>
        {{ form.postal_code.label_tag }}<br>
        {{ form.postal_code }}<br>
        <button type="button" id="search-address">住所検索</button>
    </p>
    <p>
        {{ form.address.label_tag }}<br>
        {{ form.address }}
    </p>

        <button type="submit">予約確認へ</button>
    
</form>

<script>
document.getElementById('search-address').addEventListener('click', function () {
    const postalCodeInput = document.querySelector('input[name="postal_code"]');
    const postalCode = postalCodeInput.value.trim();

    // 郵便番号の形式を検証（ハイフンなし7桁）
    if (!/^\d{7}$/.test(postalCode)) {
        alert("郵便番号はハイフン無しで入力してください（例: 1234567)");
        return;
    }

    // 郵便番号APIの呼び出し
    fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${postalCode}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data && data.results) {
                const result = data.results[0];
                const address = `${result.address1} ${result.address2} ${result.address3}`;
                const addressField = document.querySelector('textarea[name="address"]') || document.querySelector('input[name="address"]');
                if (addressField) {
                    addressField.value = address;
                } else {
                    console.error("Address field not found in the form.");
                }
            } else if (data.message) {
                // APIが返すエラーメッセージを表示
                alert(`エラー: ${data.message}`);
            } else {
                alert("住所が見つかりませんでした。郵便番号を確認してください。");
            }
        })
        .catch(error => {
            console.error("Error fetching address:", error);
            alert("住所検索でエラーが発生しました。");
        });
});



</script>




